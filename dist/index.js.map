{"version":3,"file":"index.js","sources":["../src/focus-target/use-focus-target.ts","../src/focus-target/func.focus-target.ts","../src/focus-target/event-boundary.tsx"],"sourcesContent":["import React, { FocusEvent, useRef, useEffect, RefObject } from \"react\";\r\nimport { Props, Refs, Target } from \"../types/index\";\r\nimport {\r\n  getUniqueTargetsNames,\r\n  getTarget,\r\n  addKey,\r\n  removeKey,\r\n} from \"./func.focus-target\";\r\n\r\nexport default (targets: Target[], global: boolean): Props => {\r\n  const refs = useRef<Refs>(\r\n    getUniqueTargetsNames(targets).map((name: string) => ({\r\n      name: name,\r\n      ref: React.createRef<any>(),\r\n    }))\r\n  );\r\n\r\n  const pressedKeys = useRef<string[]>([]);\r\n  const currentlyFocused = useRef(\"\");\r\n\r\n  const getRef = (name: string) => {\r\n    for (let ref of refs.current) {\r\n      if (ref.name === name) {\r\n        return ref.ref;\r\n      }\r\n    }\r\n    return undefined;\r\n  };\r\n\r\n  const setRef = (newRef: RefObject<any>) => {\r\n    if (newRef && newRef.current) {\r\n      const name = newRef.current.name;\r\n      refs.current.forEach(\r\n        (\r\n          ref: { name: string; ref: RefObject<HTMLInputElement> },\r\n          index: number\r\n        ) => {\r\n          if (ref.name === name) refs.current[index].ref = newRef;\r\n        }\r\n      );\r\n    }\r\n  };\r\n\r\n  const handleKeyDown = <T>(event: T): void => {\r\n    //@ts-ignore\r\n    let key = event.key;\r\n    key = key.length === 1 ? key.toLowerCase() : key;\r\n    // Developer tools\r\n    if (key === \"F12\") return;\r\n    pressedKeys.current = addKey(key, pressedKeys.current);\r\n    const [found, target] = getTarget(\r\n      targets,\r\n      pressedKeys.current,\r\n      currentlyFocused.current\r\n    );\r\n    if (found && target) {\r\n      const ref = getRef(target.name);\r\n      ref && ref.current && ref.current.focus();\r\n    }\r\n  };\r\n\r\n  const handleKeyUp = <T>(event: T): void => {\r\n    //@ts-ignore\r\n    let key = event.key;\r\n    key = key.length === 1 ? key.toLowerCase() : key;\r\n\r\n    pressedKeys.current = removeKey(key, pressedKeys.current);\r\n  };\r\n\r\n  const handleFocus = <T>(event: FocusEvent<T>) => {\r\n    //@ts-ignore\r\n    currentlyFocused.current = event.target.name;\r\n  };\r\n\r\n  const focus = (name: string) => {\r\n    let ref = getRef(name);\r\n    ref && ref.current && ref.current.focus();\r\n  };\r\n\r\n  useEffect(() => {\r\n    if (global) {\r\n      window.onkeydown = handleKeyDown;\r\n      window.onkeyup = handleKeyUp;\r\n    }\r\n  }, []);\r\n\r\n  return {\r\n    getRef,\r\n    setRef,\r\n    handleFocus,\r\n    handleKeyDown,\r\n    handleKeyUp,\r\n    focus,\r\n  };\r\n};\r\n","import { produce } from \"immer\";\r\nimport { Target } from \"../types/index\";\r\nimport { WritableDraft } from \"immer/dist/internal\";\r\n\r\nexport const getUniqueTargetsNames = (targets: Target[]) => {\r\n  const set = new Set<string>();\r\n  targets.forEach((target: Target) => set.add(target.name));\r\n  return Array.from(set);\r\n};\r\n\r\nexport const getTarget = (\r\n  targets: Target[],\r\n  pressedKeys: string[],\r\n  previous?: string\r\n): [boolean, Target | null] => {\r\n  for (let target of targets) {\r\n    for (let targetKeys of target.keys) {\r\n      const sizeMatches = targetKeys.length === pressedKeys.length;\r\n      const keysMatch =\r\n        sizeMatches &&\r\n        targetKeys.reduce(\r\n          (acc: boolean, targetKey: string) =>\r\n            acc\r\n              ? pressedKeys.includes(\r\n                  targetKey.length === 1 ? targetKey.toLowerCase() : targetKey\r\n                )\r\n              : false,\r\n          true\r\n        );\r\n      const previousIsSet = target.previous;\r\n      const previousMatch = previous === target.previous;\r\n\r\n      const found = previousIsSet ? previousMatch && keysMatch : keysMatch;\r\n\r\n      if (found) {\r\n        return [true, target];\r\n      }\r\n    }\r\n  }\r\n  return [false, null];\r\n};\r\n\r\nexport const addKey = (keyToAdd: string, pressedKeys: string[]) => {\r\n  const draftFunction = (draft: WritableDraft<string[]>) => {\r\n    !draft.includes(keyToAdd) && draft.push(keyToAdd);\r\n  };\r\n  return produce(pressedKeys, draftFunction);\r\n};\r\n\r\nexport const removeKey = (keyToRemove: string, pressedKeys: string[]) => {\r\n  const draftFunction = (draft: WritableDraft<string[]>) => {\r\n    return draft.filter((key) => key !== keyToRemove);\r\n  };\r\n  return produce(pressedKeys, draftFunction);\r\n};\r\n","import React, {\r\n  ReactElement,\r\n  cloneElement,\r\n  CSSProperties,\r\n  useEffect,\r\n} from \"react\";\r\nimport { injectProps, Target } from \"../types/index\";\r\nimport FocusTarget from \"./use-focus-target\";\r\n\r\nconst inject: injectProps = (child, ref, handleFocus) =>\r\n  cloneElement(child, { ref, onFocus: handleFocus });\r\n\r\nconst isSupported = (type: any) => {\r\n  switch (type) {\r\n    case \"input\":\r\n    case \"textarea\":\r\n      return true;\r\n    default:\r\n      return false;\r\n  }\r\n};\r\n\r\nexport const EventBoundary = ({\r\n  targets,\r\n  initialFocus,\r\n  children,\r\n  className,\r\n  style,\r\n}: {\r\n  targets: Target[];\r\n  initialFocus: string;\r\n  children: ReactElement[];\r\n  className?: string;\r\n  style?: CSSProperties;\r\n}) => {\r\n  const {\r\n    getRef,\r\n    handleKeyDown,\r\n    handleKeyUp,\r\n    handleFocus,\r\n    focus,\r\n  } = FocusTarget(targets, false);\r\n\r\n  useEffect(() => {\r\n    focus(initialFocus);\r\n  }, []);\r\n  return (\r\n    <div\r\n      onKeyDown={handleKeyDown}\r\n      onKeyUp={handleKeyUp}\r\n      className={className}\r\n      style={{ outline: \"none\", ...style }}\r\n      tabIndex={1000}\r\n    >\r\n      {children.map((child: ReactElement) =>\r\n        isSupported(child.type)\r\n          ? inject(child, getRef(child.props.name), handleFocus)\r\n          : child\r\n      )}\r\n    </div>\r\n  );\r\n};\r\n"],"names":["targets","global","refs","useRef","set","Set","forEach","target","add","name","Array","from","getUniqueTargetsNames","map","ref","React","createRef","pressedKeys","currentlyFocused","getRef","_a","current","_i","handleKeyDown","event","key","length","toLowerCase","keyToAdd","produce","draft","includes","push","addKey","previous","targets_1","_b","keys","targetKeys","keysMatch","reduce","acc","targetKey","previousIsSet","previousMatch","getTarget","found","focus","handleKeyUp","keyToRemove","filter","removeKey","useEffect","window","onkeydown","onkeyup","setRef","newRef","name_1","index","handleFocus","initialFocus","children","className","style","FocusTarget","_jsx","onKeyDown","onKeyUp","outline","tabIndex","child","type","isSupported","cloneElement","onFocus","inject","props"],"mappings":"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"}